<!DOCTYPE html>
<html>
  <head>
    <title>SLO Trash</title>
    <meta name="viewport" content="initial-scale=1.0,user-scalable=no"/>
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.3/leaflet.css" />
    <style type="text/css">
      :root, body { margin: 0; padding: 0 }
      #map { height: 100vh }
    </style>
  </head>
  <body>
    <div id="map"></div>
    <script src="//code.jquery.com/jquery-1.11.3.min.js"></script>
    <script src="//code.jquery.com/jquery-migrate-1.2.1.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.3/leaflet.js"></script>
    <script>
      var map = L.map('map').setView([35.28, -120.67], 14);

      L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}', {
          attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="http://mapbox.com">Mapbox</a>',
          maxZoom: 18,
          id: '{{ mapbox_id }}',
          accessToken: '{{ mapbox_token }}'
      }).addTo(map);

      $.getJSON('/trashcans', function(data) {
        data.trashcans.forEach(function(t) {
          var title = t.name + ': ';
          if (t.distance !== null)
            title += t.distance + ' ' + t.units +
                     ' (' + t.percent + '%)' +
                     '<br><a href="/graph/' + t.name + '">History</a>';
          else
            title += 'no data';
          L.marker(t).addTo(map)
            .bindPopup(title);
        });
        if (data.trashcans.length)
          map.fitBounds(data.trashcans, {maxZoom: 14});
      });
    </script>
  </body>
</html>
